name: Continuous Integration
on:
  push:
    branches:
    - master
    - rasa-2-0
    - gha


jobs:
  docker:
    name: Build Action Server Docker Image
    runs-on: ubuntu-latest
    env:
      DOCKERHUB_USERNAME: oakela
    steps:
      - name: set_tag_latest
        if: |
            github.ref == 'refs/heads/master' 
            || github.head_ref == 'refs/heads/master'
        run: echo "TAG=latest" >> $GITHUB_ENV
      - name: set_tag_2
        if: |
            github.ref == 'refs/heads/rasa-2-0' 
            || github.head_ref == 'refs/heads/rasa-2-0'
        run: echo "TAG=2" >> $GITHUB_ENV
      - name: set_tag_gha
        if: |
            github.ref == 'refs/heads/gha' 
            || github.head_ref == 'refs/heads/gha'
        run: echo "TAG=gha" >> $GITHUB_ENV
      - run: echo ${{ env.TAG }}
      - name: Checkout git repository üïù
        uses: actions/checkout@v2
      - name: Build Actions Server Image
        uses: RasaHQ/rasa-action-server-gha@main
        with:
          actions_directory: 'actions'
          requirements_file: 'actions/requirements-actions.txt'
          docker_registry_login: ${{ env.DOCKERHUB_USERNAME }}
          docker_registry_password: ${{ secrets.DOCKERHUB_PASSWORD }}
          docker_image_name: 'rasa/financial-demo'
          docker_image_tag: ${{ env.TAG }}
          rasa_sdk_version: '2.2.0'
